
# 前言

虽然 uni-app 号称可以一套代码横跨十几个不同的平台，但不同的平台总有一些特定的需求要单独实现，例如：在APP 端要对接 Apple 账号登录，在微信小程序端要对接微信登录。又例如我们上节课学的广告，在微信小程序平台，我们只能使用微信的广告组件。遇到这样的情况，在 uni-app 中最好的解决方案就是条件编译。

# 什么是条件编译

条件编译不是运行时判断当前设备是什么，而是在编译阶段判断设备是什么。通过判断，使用不同的条件下的代码块。使用起来也非常简单

以 `#ifdef` 或 `#ifndef` 加 `%PLATFORM%` 开头，以 `#endif` 结尾。
- `#ifdef`：if defined 仅在某平台存在
- `#ifndef`：if not defined 除了某平台均存在
- `%PLATFORM%`：平台名称

# 在代码中使用条件编译

uni-app的条件编译可以应用于 template ，style，script 甚至是.json 的配置文件中等等，以下针对不同平台使用不同广告组件的代码就是应用在.vue文件的 template 中。

```
<!-- #ifdef MP-WEIXIN -->
<ad unit-id=""></ad>
<!-- #endif -->
<!-- #ifndef MP-WEIXIN -->
<ad adpid=""></ad>
<!-- #endif -->
```

由于条件编译是用特殊的注释作为标记的，在编译时会根据这些特殊的注释，将注释里面的代码编译到不同平台，所以在不同的位置使用条件编译，语法有细微差别

下面是应用于 script 中的条件编译，它将在编译到 微信小程序 和 非微信小程序 时使用不同的代码块
```
// #ifdef MP-WEIXIN
代码不会生效
// #endif
// #ifndef MP-WEIXIN
代码会生效
// #endif
```

# 静态文件的条件编译

例如，我们的 APP 图标或者其他资源，在代码中使用的是相同路径，相同的文件名。但是我们又需要它在不同平台下的呈现不一样，此时我们就可以使用静态文件的条件编译。

我们可以在`static` 目录下新建不同平台的专有目录，目录名称均为 小写

![[Pasted image 20241019004825.png]]


如以下目录结构，`a.png` 只有在微信小程序平台才会编译进去，`b.png` 在所有平台都会被编译。

```
┌─static
│  ├─mp-weixin
│  │  └─a.png
│  └─b.png
├─main.js
├─App.vue
├─manifest.json
└─pages.json
```

# 结语

uni-app 是强大的跨端框架，可以一套代码运行发布到十几个不同的平台，但往往有一些特殊情况我们不得已要针对不同的平台做一些平台特色的需求，用好 uni-app 的条件编译，可以让我们的代码更容易复用，更容易维护。